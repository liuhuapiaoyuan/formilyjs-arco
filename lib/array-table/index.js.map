{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["array-table/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, {\n  Fragment,\n  useState,\n  useRef,\n  forwardRef,\n  useContext,\n} from 'react'\nimport { Table, Pagination, Space, Select, Badge } from '@arco-design/web-react'\nimport { PaginationProps } from '@arco-design/web-react/es/pagination'\nimport { TableProps, ColumnProps } from '@arco-design/web-react/es/table'\nimport { SelectProps } from '@arco-design/web-react/es/select'\nimport cls from 'classnames'\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc'\nimport { GeneralField, FieldDisplayTypes, ArrayField } from '@formily/core'\nimport {\n  useField,\n  observer,\n  useFieldSchema,\n  RecursionField,\n} from '@formily/react'\nimport { isArr, isBool } from '@formily/shared'\nimport { Schema } from '@formily/json-schema'\n\nimport './index.scss'\nimport { usePrefixCls } from '../__builtins__'\nimport { ArrayBase, ArrayBaseMixins, IArrayBaseProps } from '../array-base'\n\ninterface ObservableColumnSource {\n  field: GeneralField\n  columnProps: ColumnProps<any>\n  schema: Schema\n  display: FieldDisplayTypes\n  name: string\n}\ninterface IArrayTablePaginationProps extends PaginationProps {\n  dataSource?: any[]\n  children?: (\n    dataSource: any[],\n    pagination: React.ReactNode\n  ) => React.ReactElement\n}\n\ninterface IStatusSelectProps extends SelectProps {\n  pageSize?: number\n}\n\ntype ComposedArrayTable = React.FC<TableProps<any>> &\n  ArrayBaseMixins & {\n    Column?: React.FC<ColumnProps<any>>\n  }\n\nconst SortableRow = SortableElement((props: any) => <tr {...props} />)\nconst SortableBody = SortableContainer((props: any) => <tbody {...props} />)\n\nconst isColumnComponent = (schema: Schema) => {\n  return schema['x-component']?.indexOf('Column') > -1\n}\n\nconst isOperationsComponent = (schema: Schema) => {\n  return schema['x-component']?.indexOf('Operations') > -1\n}\n\nconst isAdditionComponent = (schema: Schema) => {\n  return schema['x-component']?.indexOf('Addition') > -1\n}\n\nconst useArrayTableSources = () => {\n  const arrayField = useField()\n  const schema = useFieldSchema()\n  const parseSources = (schema: Schema): ObservableColumnSource[] => {\n    if (\n      isColumnComponent(schema) ||\n      isOperationsComponent(schema) ||\n      isAdditionComponent(schema)\n    ) {\n      if (!schema['x-component-props']?.['dataIndex'] && !schema['name'])\n        return []\n      const name = schema['x-component-props']?.['dataIndex'] || schema['name']\n      const field = arrayField.query(arrayField.address.concat(name)).take()\n      const columnProps =\n        field?.component?.[1] || schema['x-component-props'] || {}\n      const display = field?.display || schema['x-display']\n      return [\n        {\n          name,\n          display,\n          field,\n          schema,\n          columnProps,\n        },\n      ]\n    } else if (schema.properties) {\n      return schema.reduceProperties((buf, schema) => {\n        return buf.concat(parseSources(schema))\n      }, [])\n    }\n    return []\n  }\n\n  const parseArrayItems = (schema: Schema['items']) => {\n    const sources: ObservableColumnSource[] = []\n    const items = isArr(schema) ? schema : [schema]\n    return items.reduce((columns, schema) => {\n      const item = parseSources(schema as Schema)\n      if (item) {\n        return columns.concat(item)\n      }\n      return columns\n    }, sources)\n  }\n\n  if (!schema) throw new Error('can not found schema object')\n\n  return parseArrayItems(schema.items)\n}\n\nconst getTableColumns = (\n  sources: ObservableColumnSource[]\n): TableProps<any>['columns'] => {\n  return sources.reduce(\n    (buf: any, { name, columnProps, schema, display }, key) => {\n      if (display !== 'visible') return buf\n      if (!isColumnComponent(schema)) return buf\n      return buf.concat({\n        ...columnProps,\n        key,\n        dataIndex: name,\n        render: (value: any, record: any, index) => {\n          const children = (\n            <ArrayBase.Item index={index} record={record}>\n              <RecursionField\n                schema={schema}\n                name={index}\n                onlyRenderProperties\n              />\n            </ArrayBase.Item>\n          )\n          return index > -1 ? children : null\n        },\n      })\n    },\n    []\n  )\n}\n\nconst useAddition = () => {\n  const schema = useFieldSchema()\n  return schema.reduceProperties((addition, schema, key) => {\n    if (isAdditionComponent(schema)) {\n      return <RecursionField schema={schema} name={key} />\n    }\n    return addition\n  }, null)\n}\n\nconst schedulerRequest = {\n  request: null,\n}\nconst StatusSelect: React.FC<IStatusSelectProps> = observer(\n  (props) => {\n    const field = useField<ArrayField>()\n    const prefixCls = usePrefixCls('array-table')\n    const errors = field.errors\n    const parseIndex = (address: string) => {\n      return Number(\n        address\n          .slice(address.indexOf(field.address.toString()) + 1)\n          .match(/(\\d+)/)?.[1]\n      )\n    }\n    const options = props.options?.map(({ label, value }: any) => {\n      const hasError = errors.some(({ address }) => {\n        const currentIndex = parseIndex(address)\n        const startIndex = (value - 1) * props.pageSize\n        const endIndex = value * props.pageSize\n        return currentIndex >= startIndex && currentIndex <= endIndex\n      })\n      return {\n        label: hasError ? <Badge dot>{label}</Badge> : label,\n        value,\n      }\n    })\n\n    const width = String(options?.length).length * 15\n\n    return (\n      <Select\n        value={props.value}\n        onChange={props.onChange}\n        options={options}\n        style={{\n          width: width < 60 ? 60 : width,\n        }}\n        className={cls(`${prefixCls}-status-select`, {\n          'has-error': errors?.length,\n        })}\n      />\n    )\n  },\n  {\n    scheduler: (update) => {\n      clearTimeout(schedulerRequest.request)\n      schedulerRequest.request = setTimeout(() => {\n        update()\n      }, 100)\n    },\n  }\n)\n\nconst ArrayTablePagination: React.FC<IArrayTablePaginationProps> = (props) => {\n  const [current, setCurrent] = useState(1)\n  const prefixCls = usePrefixCls('array-table')\n  const pageSize = props.pageSize || 10\n  const size = props.size || 'default'\n  const dataSource = props.dataSource || []\n  const startIndex = (current - 1) * pageSize\n  const endIndex = startIndex + pageSize - 1\n  const total = dataSource?.length || 0\n  const totalPage = Math.ceil(total / pageSize)\n  const pages = Array.from(new Array(totalPage)).map((_, index) => {\n    const page = index + 1\n    return {\n      label: page,\n      value: page,\n    }\n  })\n  const handleChange = (current: number) => {\n    setCurrent(current)\n  }\n\n  const renderPagination = () => {\n    if (totalPage <= 1) return\n    return (\n      <div className={`${prefixCls}-pagination`}>\n        <Space>\n          <StatusSelect\n            value={current}\n            pageSize={pageSize}\n            onChange={handleChange}\n            options={pages}\n          />\n          <Pagination\n            {...props}\n            pageSize={pageSize}\n            current={current}\n            total={dataSource.length}\n            size={size}\n            showJumper\n            showMore={false}\n            onChange={handleChange}\n          />\n        </Space>\n      </div>\n    )\n  }\n\n  return (\n    <Fragment>\n      {props.children?.(\n        dataSource?.slice(startIndex, endIndex + 1),\n        renderPagination()\n      )}\n    </Fragment>\n  )\n}\n// components.wrapper所需要参数\nconst ArrayTableComponentsContext = React.createContext<{\n  ref?: React.RefObject<HTMLDivElement | null>\n  field?: ArrayField\n}>({})\n\nconst ArrayTableWrapper: React.FC = (props: any) => {\n  const { ref, field } = useContext(ArrayTableComponentsContext)\n  const prefixCls = usePrefixCls('formily-array-table')\n  const addTdStyles = (node: HTMLElement) => {\n    const helper = document.body.querySelector(`.${prefixCls}-sort-helper`)\n    if (helper) {\n      const tds = node.querySelectorAll('td')\n      requestAnimationFrame(() => {\n        helper.querySelectorAll('td').forEach((td, index) => {\n          if (tds[index]) {\n            td.style.width = getComputedStyle(tds[index]).width\n          }\n        })\n      })\n    }\n  }\n\n  return (\n    <SortableBody\n      useDragHandle\n      lockAxis=\"y\"\n      helperClass={`${prefixCls}-sort-helper`}\n      helperContainer={() => {\n        return ref?.current?.querySelector('tbody')\n      }}\n      onSortStart={({ node }) => {\n        addTdStyles(node)\n      }}\n      onSortEnd={({ oldIndex, newIndex }) => {\n        field?.move(oldIndex, newIndex)\n      }}\n      {...props}\n    />\n  )\n}\n\n/**\n * 这里将Table.components写在函数外，使得components避免不必要的更新\n *\n * 原因：如果每次render时Table每次都拿到一个新的对象。Table内部是lodash.merge深拷贝了一份这个对象，导致components.body.row & wrapper每次都会变。\n * 当在array-table中用如文件上传组件时，会将原先的input销毁，导致没法监听到组件的onChange事件\n */\nconst arrayTableComponents: TableProps['components'] = {\n  body: {\n    tbody: ArrayTableWrapper,\n    row: forwardRef((props: any, ref) => {\n      return <SortableRow ref={ref} index={props.index || 0} {...props} />\n    }),\n  },\n}\n\nexport const ArrayTable: ComposedArrayTable = observer(\n  (props: TableProps<any> & { arrayBaseProps: IArrayBaseProps }) => {\n    const ref: any = useRef<HTMLDivElement>()\n    const field = useField<ArrayField>()\n    const prefixCls = usePrefixCls('array-table')\n    const dataSource = Array.isArray(field.value) ? field.value.slice() : []\n    const sources = useArrayTableSources()\n    const columns = getTableColumns(sources)\n    const pagination = isBool(props.pagination) ? {} : props.pagination\n    const addition = useAddition()\n    const defaultRowKey = (record?: any) => {\n      return dataSource.indexOf(record).toString()\n    }\n\n    return (\n      <ArrayTablePagination {...pagination} dataSource={dataSource}>\n        {(dataSource, pager) => (\n          <div ref={ref} className={prefixCls}>\n            <ArrayBase {...props?.arrayBaseProps}>\n              <ArrayTableComponentsContext.Provider value={{ ref, field }}>\n                <Table\n                  size=\"small\"\n                  border\n                  rowKey={defaultRowKey}\n                  {...props}\n                  onChange={() => {}}\n                  pagination={false}\n                  columns={columns}\n                  data={dataSource}\n                  components={arrayTableComponents}\n                  onRow={(_, index) => ({\n                    index,\n                  })}\n                />\n              </ArrayTableComponentsContext.Provider>\n              <div style={{ marginTop: 5, marginBottom: 5 }}>{pager}</div>\n              {sources.map((column, key) => {\n                // 承接对Column的状态管理\n                if (!isColumnComponent(column.schema)) return\n                return React.createElement(RecursionField, {\n                  name: column.name,\n                  schema: column.schema,\n                  onlyRenderSelf: true,\n                  key,\n                })\n              })}\n              {addition}\n            </ArrayBase>\n          </div>\n        )}\n      </ArrayTablePagination>\n    )\n  }\n)\n\nArrayTable.displayName = 'ArrayTable'\n\nArrayTable.Column = () => {\n  return <Fragment />\n}\n\nArrayBase.mixin(ArrayTable)\n\nexport default ArrayTable\n"]}