{"version":3,"file":"scope.js","sourceRoot":"lib/","sources":["schema-form/scope.ts"],"names":[],"mappings":";;;AAAA,8CAA2C;AAG3C,SAAS,2BAA2B,CAAC,KAAY;;IAC/C,OAAO,CACL,CAAA,MAAA,KAAK,CAAC,UAAU,0CAAE,SAAS,CACzB,UAAC,EAAc;;YAAZ,KAAK,WAAA;QAAY,OAAA,KAAK,CAAC,KAAK,KAAK,KAAK,KAAI,MAAA,KAAK,CAAC,KAAK,0CAAE,QAAQ,CAAC,KAAK,CAAC,CAAA,CAAA;KAAA,CAC1E,MAAK,CAAC,CAAC,CACT,CAAC;AACJ,CAAC;AAEM,IAAM,kBAAkB,GAC7B,UAAC,OAAoD,EAAE,UAAiB;IAAjB,2BAAA,EAAA,iBAAiB;IACxE,OAAA,UAAC,KAAY,EAAE,IAAW;;QACxB,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC;QACrB,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CACvB,MAAA,iBAAM,aAAN,iBAAM,uBAAN,iBAAM,CAAE,KAAK,kEAAG,UAAC,IAAI;YACnB,KAAK,CAAC,UAAU,GAAG,IAAI,CAAC;YACxB,IAAI,UAAU,IAAI,2BAA2B,CAAC,KAAK,CAAC,EAAE;gBACpD,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;aAC3B;YACD,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;QACxB,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;AAXD,CAWC,CAAC;AAbS,QAAA,kBAAkB,sBAa3B","sourcesContent":["import { action } from \"@formily/reactive\";\r\nimport { Field, Form } from \"@formily/core/esm/models\";\r\n\r\nfunction checkExsitInFieldDataSource(field: Field) {\r\n  return (\r\n    field.dataSource?.findIndex(\r\n      ({ value }: any) => field.value === value || field.value?.includes(value)\r\n    ) === -1\r\n  );\r\n}\r\n\r\nexport const useAsyncDataSource =\r\n  (service: (field: Field, form?: Form) => Promise<any>, checkExsit = true) =>\r\n  (field: Field, form?: Form) => {\r\n    field.loading = true;\r\n    service(field, form).then(\r\n      action?.bound?.((data) => {\r\n        field.dataSource = data;\r\n        if (checkExsit && checkExsitInFieldDataSource(field)) {\r\n          field.setValue(undefined);\r\n        }\r\n        field.loading = false;\r\n      })\r\n    );\r\n  };\r\n"]}