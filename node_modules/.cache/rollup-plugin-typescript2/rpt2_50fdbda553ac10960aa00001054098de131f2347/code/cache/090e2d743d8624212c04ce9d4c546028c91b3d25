{"code":"import { __assign, __awaiter, __generator, __read } from \"tslib\";\r\nimport React, { Fragment, useRef, useLayoutEffect, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { createForm } from \"@formily/core\";\r\nimport { toJS } from \"@formily/reactive\";\r\nimport { FormProvider, Observer, observer } from \"@formily/react\";\r\nimport { isNum, isStr, isBool, isFn, applyMiddleware, } from \"@formily/shared\";\r\nimport { Modal } from \"@arco-design/web-react\";\r\nimport { usePrefixCls, loading, createPortalProvider, createPortalRoot, } from \"../__builtins__\";\r\nvar isModalTitle = function (props) {\r\n    return isNum(props) || isStr(props) || isBool(props) || React.isValidElement(props);\r\n};\r\nvar getModelProps = function (props) {\r\n    if (isModalTitle(props)) {\r\n        return {\r\n            title: props,\r\n        };\r\n    }\r\n    else {\r\n        return props;\r\n    }\r\n};\r\nexport function FormDialog(title, id, renderer) {\r\n    var _this = this;\r\n    if (isFn(id) || React.isValidElement(id)) {\r\n        renderer = id;\r\n        id = \"form-dialog\";\r\n    }\r\n    var env = {\r\n        host: document.createElement(\"div\"),\r\n        form: null,\r\n        promise: null,\r\n        openMiddlewares: [],\r\n        confirmMiddlewares: [],\r\n        cancelMiddlewares: [],\r\n    };\r\n    var root = createPortalRoot(env.host, id);\r\n    var props = getModelProps(title);\r\n    var modal = __assign(__assign({}, props), { afterClose: function () {\r\n            var _a;\r\n            (_a = props === null || props === void 0 ? void 0 : props.afterClose) === null || _a === void 0 ? void 0 : _a.call(props);\r\n            root.unmount();\r\n        } });\r\n    var DialogContent = observer(function () { return (React.createElement(Fragment, null, isFn(renderer) ? renderer(env.form) : renderer)); });\r\n    var renderDialog = function (visible, resolve, reject) {\r\n        if (visible === void 0) { visible = true; }\r\n        return (React.createElement(Observer, null, function () {\r\n            var _a, _b;\r\n            return (React.createElement(Modal, __assign({}, modal, (((_a = modal === null || modal === void 0 ? void 0 : modal.getModalProps) === null || _a === void 0 ? void 0 : _a.call(modal, __assign(__assign({}, modal), { triggerConfirm: resolve, triggerCancel: reject }))) || {}), { visible: visible, confirmLoading: (_b = env === null || env === void 0 ? void 0 : env.form) === null || _b === void 0 ? void 0 : _b.submitting, onCancel: function () {\r\n                    var _a;\r\n                    if (((_a = modal === null || modal === void 0 ? void 0 : modal.onCancel) === null || _a === void 0 ? void 0 : _a.call(modal)) !== false) {\r\n                        reject === null || reject === void 0 ? void 0 : reject();\r\n                    }\r\n                }, onOk: function (e) { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        if (((_a = modal === null || modal === void 0 ? void 0 : modal.onOk) === null || _a === void 0 ? void 0 : _a.call(modal, e)) !== false) {\r\n                            resolve === null || resolve === void 0 ? void 0 : resolve();\r\n                        }\r\n                        return [2 /*return*/];\r\n                    });\r\n                }); }, onConfirm: function (e) { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        if (((_a = modal === null || modal === void 0 ? void 0 : modal.onOk) === null || _a === void 0 ? void 0 : _a.call(modal, e)) !== false) {\r\n                            resolve === null || resolve === void 0 ? void 0 : resolve();\r\n                        }\r\n                        return [2 /*return*/];\r\n                    });\r\n                }); } }), env.form ? (React.createElement(FormProvider, { form: env.form },\r\n                React.createElement(DialogContent, null))) : null));\r\n        }));\r\n    };\r\n    document.body.appendChild(env.host);\r\n    var formDialog = {\r\n        forOpen: function (middleware) {\r\n            if (isFn(middleware)) {\r\n                env.openMiddlewares.push(middleware);\r\n            }\r\n            return formDialog;\r\n        },\r\n        forConfirm: function (middleware) {\r\n            if (isFn(middleware)) {\r\n                env.confirmMiddlewares.push(middleware);\r\n            }\r\n            return formDialog;\r\n        },\r\n        forCancel: function (middleware) {\r\n            if (isFn(middleware)) {\r\n                env.cancelMiddlewares.push(middleware);\r\n            }\r\n            return formDialog;\r\n        },\r\n        open: function (formProps) { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                if (env.promise) {\r\n                    return [2 /*return*/, env.promise];\r\n                }\r\n                env.promise = new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                    var e_1;\r\n                    var _this = this;\r\n                    return __generator(this, function (_a) {\r\n                        switch (_a.label) {\r\n                            case 0:\r\n                                _a.trys.push([0, 2, , 3]);\r\n                                return [4 /*yield*/, loading(modal.loadingText, function () {\r\n                                        return applyMiddleware(formProps, env.openMiddlewares);\r\n                                    })];\r\n                            case 1:\r\n                                formProps = _a.sent();\r\n                                env.form = env.form || createForm(formProps);\r\n                                return [3 /*break*/, 3];\r\n                            case 2:\r\n                                e_1 = _a.sent();\r\n                                reject(e_1);\r\n                                return [3 /*break*/, 3];\r\n                            case 3:\r\n                                root.render(function () {\r\n                                    return renderDialog(true, function () {\r\n                                        var _a;\r\n                                        (_a = env.form) === null || _a === void 0 ? void 0 : _a.submit(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                            var _a;\r\n                                            return __generator(this, function (_b) {\r\n                                                switch (_b.label) {\r\n                                                    case 0: return [4 /*yield*/, applyMiddleware(env.form, env.confirmMiddlewares)];\r\n                                                    case 1:\r\n                                                        _b.sent();\r\n                                                        resolve(toJS((_a = env.form) === null || _a === void 0 ? void 0 : _a.values));\r\n                                                        formDialog.close();\r\n                                                        return [2 /*return*/];\r\n                                                }\r\n                                            });\r\n                                        }); }).catch(function () {\r\n                                            /** do nothing */\r\n                                        });\r\n                                    }, function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                        return __generator(this, function (_a) {\r\n                                            switch (_a.label) {\r\n                                                case 0: return [4 /*yield*/, loading(modal.loadingText, function () {\r\n                                                        return applyMiddleware(env.form, env.cancelMiddlewares);\r\n                                                    })];\r\n                                                case 1:\r\n                                                    _a.sent();\r\n                                                    formDialog.close();\r\n                                                    return [2 /*return*/];\r\n                                            }\r\n                                        });\r\n                                    }); });\r\n                                });\r\n                                return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); });\r\n                return [2 /*return*/, env.promise];\r\n            });\r\n        }); },\r\n        close: function () {\r\n            if (!env.host) {\r\n                return;\r\n            }\r\n            root.render(function () { return renderDialog(false); });\r\n        },\r\n    };\r\n    return formDialog;\r\n}\r\nvar DialogFooter = function (props) {\r\n    var ref = useRef(null);\r\n    var _a = __read(useState(), 2), footer = _a[0], setFooter = _a[1];\r\n    var footerRef = useRef();\r\n    var prefixCls = usePrefixCls(\"\", {\r\n        prefixCls: \"semi-modal\",\r\n    });\r\n    useLayoutEffect(function () {\r\n        var _a;\r\n        var content = (_a = ref.current) === null || _a === void 0 ? void 0 : _a.closest(\".\".concat(prefixCls, \"-content\"));\r\n        if (content) {\r\n            if (!footerRef.current) {\r\n                footerRef.current = content.querySelector(\".\".concat(prefixCls, \"-footer\"));\r\n                if (!footerRef.current) {\r\n                    footerRef.current = document.createElement(\"div\");\r\n                    footerRef.current.classList.add(\"\".concat(prefixCls, \"-footer\"));\r\n                    content.appendChild(footerRef.current);\r\n                }\r\n            }\r\n            setFooter(footerRef.current);\r\n        }\r\n    });\r\n    footerRef.current = footer;\r\n    return (React.createElement(\"div\", { ref: ref, style: { display: \"none\" } }, footer && createPortal(props.children, footer)));\r\n};\r\nFormDialog.Footer = DialogFooter;\r\nFormDialog.Portal = createPortalProvider(\"form-dialog\");\r\nexport default FormDialog;\r\n//# sourceMappingURL=index.js.map","references":["H:/projects/formilyjs-arco/node_modules/@types/react/index.d.ts","H:/projects/formilyjs-arco/node_modules/@types/react-dom/index.d.ts","H:/projects/formilyjs-arco/node_modules/@formily/core/esm/index.d.ts","H:/projects/formilyjs-arco/node_modules/@formily/reactive/esm/index.d.ts","H:/projects/formilyjs-arco/node_modules/@formily/react/esm/index.d.ts","H:/projects/formilyjs-arco/node_modules/@formily/shared/esm/index.d.ts","H:/projects/formilyjs-arco/node_modules/@arco-design/web-react/es/index.d.ts","H:/projects/formilyjs-arco/node_modules/@arco-design/web-react/es/modal/interface.d.ts","H:/projects/formilyjs-arco/packages/components/src/__builtins__/index.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/form-dialog/index.tsx\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"import React, { Fragment, useRef, useLayoutEffect, useState } from \\\"react\\\";\\nimport { createPortal } from \\\"react-dom\\\";\\nimport { createForm, IFormProps, Form } from \\\"@formily/core\\\";\\nimport { toJS } from \\\"@formily/reactive\\\";\\nimport { FormProvider, Observer, observer } from \\\"@formily/react\\\";\\nimport {\\n  isNum,\\n  isStr,\\n  isBool,\\n  isFn,\\n  applyMiddleware,\\n  IMiddleware,\\n} from \\\"@formily/shared\\\";\\nimport { Modal } from \\\"@arco-design/web-react\\\";\\nimport type { ModalProps } from \\\"@arco-design/web-react/es/modal/interface\\\";\\nimport {\\n  usePrefixCls,\\n  loading,\\n  createPortalProvider,\\n  createPortalRoot,\\n} from \\\"../__builtins__\\\";\\n\\ntype FormDialogRenderer =\\n  | React.ReactElement\\n  | ((form: Form) => React.ReactElement);\\n\\ntype ModalTitle = string | number | React.ReactElement;\\n\\nconst isModalTitle = (props: any): props is ModalTitle =>\\n  isNum(props) || isStr(props) || isBool(props) || React.isValidElement(props);\\n\\nconst getModelProps = (props: any): IModalProps => {\\n  if (isModalTitle(props)) {\\n    return {\\n      title: props,\\n    };\\n  } else {\\n    return props;\\n  }\\n};\\n\\nexport interface IFormDialog {\\n  forOpen(middleware: IMiddleware<IFormProps>): IFormDialog;\\n  forConfirm(middleware: IMiddleware<Form>): IFormDialog;\\n  forCancel(middleware: IMiddleware<Form>): IFormDialog;\\n  open(props?: IFormProps): Promise<any>;\\n  close(): void;\\n}\\n\\nexport interface IModalProps\\n  extends Omit<ModalProps, \\\"onOk\\\" | \\\"onCancel\\\"> {\\n  getModalProps?: (\\n    props: IModalProps & {\\n      triggerConfirm?: () => any;\\n      triggerCancel?: () => any;\\n    }\\n  ) => IModalProps;\\n  onOk?: (e: any) => void | Promise<any> | boolean;\\n  onCancel?: () => void | Promise<any> | boolean;\\n  loadingText?: React.ReactNode;\\n}\\n\\nexport function FormDialog(\\n  title: IModalProps,\\n  id: string,\\n  renderer: FormDialogRenderer\\n): IFormDialog;\\nexport function FormDialog(\\n  title: IModalProps,\\n  renderer: FormDialogRenderer\\n): IFormDialog;\\nexport function FormDialog(\\n  title: ModalTitle,\\n  id: string,\\n  renderer: FormDialogRenderer\\n): IFormDialog;\\nexport function FormDialog(\\n  title: ModalTitle,\\n  renderer: FormDialogRenderer\\n): IFormDialog;\\nexport function FormDialog(title: any, id: any, renderer?: any): IFormDialog {\\n  if (isFn(id) || React.isValidElement(id)) {\\n    renderer = id;\\n    id = \\\"form-dialog\\\";\\n  }\\n  const env: {\\n    host: HTMLElement;\\n    form: Form | null;\\n    promise: Promise<any> | null;\\n    openMiddlewares: IMiddleware<IFormProps>[];\\n    confirmMiddlewares: IMiddleware<Form>[];\\n    cancelMiddlewares: IMiddleware<Form>[];\\n  } = {\\n    host: document.createElement(\\\"div\\\"),\\n    form: null,\\n    promise: null,\\n    openMiddlewares: [],\\n    confirmMiddlewares: [],\\n    cancelMiddlewares: [],\\n  };\\n  const root = createPortalRoot(env.host, id);\\n  const props = getModelProps(title);\\n  const modal = {\\n    ...props,\\n    afterClose: () => {\\n      props?.afterClose?.();\\n      root.unmount();\\n    },\\n  };\\n  const DialogContent = observer(() => (\\n    <Fragment>{isFn(renderer) ? renderer(env.form) : renderer}</Fragment>\\n  ));\\n  const renderDialog = (\\n    visible = true,\\n    resolve?: () => any,\\n    reject?: () => any\\n  ) => (\\n    <Observer>\\n      {() => (\\n        <Modal\\n          {...modal}\\n          {...(modal?.getModalProps?.({\\n            ...modal,\\n            triggerConfirm: resolve,\\n            triggerCancel: reject,\\n          }) || {})}\\n          visible={visible}\\n          confirmLoading={env?.form?.submitting}\\n          onCancel={() => {\\n            if (modal?.onCancel?.() !== false) {\\n              reject?.();\\n            }\\n          }}\\n          onOk={async (e) => {\\n            if (modal?.onOk?.(e) !== false) {\\n              resolve?.();\\n            }\\n          }}\\n          onConfirm={async (e) => {\\n            if (modal?.onOk?.(e) !== false) {\\n              resolve?.();\\n            }\\n          }}\\n        >\\n          {env.form ? (\\n            <FormProvider form={env.form}>\\n              <DialogContent />\\n            </FormProvider>\\n          ) : null}\\n        </Modal>\\n      )}\\n    </Observer>\\n  );\\n\\n  document.body.appendChild(env.host);\\n  const formDialog = {\\n    forOpen: (middleware: IMiddleware<IFormProps>) => {\\n      if (isFn(middleware)) {\\n        env.openMiddlewares.push(middleware);\\n      }\\n      return formDialog;\\n    },\\n    forConfirm: (middleware: IMiddleware<Form>) => {\\n      if (isFn(middleware)) {\\n        env.confirmMiddlewares.push(middleware);\\n      }\\n      return formDialog;\\n    },\\n    forCancel: (middleware: IMiddleware<Form>) => {\\n      if (isFn(middleware)) {\\n        env.cancelMiddlewares.push(middleware);\\n      }\\n      return formDialog;\\n    },\\n    open: async (formProps: IFormProps) => {\\n      if (env.promise) {\\n        return env.promise;\\n      }\\n\\n      env.promise = new Promise(async (resolve, reject) => {\\n        try {\\n          formProps = await loading(modal.loadingText, () =>\\n            applyMiddleware(formProps, env.openMiddlewares)\\n          );\\n          env.form = env.form || createForm(formProps);\\n        } catch (e) {\\n          reject(e);\\n        }\\n        root.render(() =>\\n          renderDialog(\\n            true,\\n            () => {\\n              env.form\\n                ?.submit(async () => {\\n                  await applyMiddleware(env.form, env.confirmMiddlewares);\\n                  resolve(toJS(env.form?.values));\\n                  formDialog.close();\\n                })\\n                .catch(() => {\\n                  /** do nothing */\\n                });\\n            },\\n            async () => {\\n              await loading(modal.loadingText, () =>\\n                applyMiddleware(env.form, env.cancelMiddlewares)\\n              );\\n              formDialog.close();\\n            }\\n          )\\n        );\\n      });\\n      return env.promise;\\n    },\\n    close: () => {\\n      if (!env.host) {\\n        return;\\n      }\\n      root.render(() => renderDialog(false));\\n    },\\n  };\\n  return formDialog;\\n}\\n\\nconst DialogFooter: React.FC = (props) => {\\n  const ref = useRef<HTMLDivElement>(null);\\n  const [footer, setFooter] = useState<HTMLDivElement>();\\n  const footerRef = useRef<HTMLDivElement>();\\n  const prefixCls = usePrefixCls(\\\"\\\", {\\n    prefixCls: \\\"semi-modal\\\",\\n  });\\n  useLayoutEffect(() => {\\n    const content = ref.current?.closest(`.${prefixCls}-content`);\\n    if (content) {\\n      if (!footerRef.current) {\\n        footerRef.current = content.querySelector(\\n          `.${prefixCls}-footer`\\n        ) as HTMLDivElement;\\n        if (!footerRef.current) {\\n          footerRef.current = document.createElement(\\\"div\\\");\\n          footerRef.current.classList.add(`${prefixCls}-footer`);\\n          content.appendChild(footerRef.current);\\n        }\\n      }\\n      setFooter(footerRef.current);\\n    }\\n  });\\n\\n  footerRef.current = footer;\\n\\n  return (\\n    <div ref={ref} style={{ display: \\\"none\\\" }}>\\n      {footer && createPortal(props.children, footer)}\\n    </div>\\n  );\\n};\\n\\nFormDialog.Footer = DialogFooter;\\n\\nFormDialog.Portal = createPortalProvider(\\\"form-dialog\\\");\\n\\nexport default FormDialog;\\n\"]}"}
